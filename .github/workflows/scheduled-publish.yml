name: Scheduled News Publishing

on:
  schedule:
    # ë§¤ì¼ ì˜¤í›„ 2ì‹œ(í•œêµ­ì‹œê°„ 14:00 = UTC 05:00)ì— ì‹œì‘
    - cron: '0 5 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥í•˜ë„ë¡
  workflow_dispatch:

jobs:
  publish-news:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Publish All News with Random Intervals
        run: |
          echo "ğŸš€ Starting scheduled news publishing..."
          echo "ğŸ“… Publishing 10 articles with 30-90 minute random intervals"
          VERCEL_URL="https://www.economynews.app"
          
          # 10ê°œ ê¸°ì‚¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë°œí–‰
          for i in {1..10}; do
            echo ""
            echo "========================================="
            echo "ğŸ“° Publishing article $i/10..."
            echo "========================================="
            
            response=$(curl -s -w "\n%{http_code}" -X POST \
              "$VERCEL_URL/api/publish" \
              -H "Content-Type: application/json")
            
            http_code=$(echo "$response" | tail -n1)
            body=$(echo "$response" | head -n-1)
            
            echo "Response: $body"
            echo "HTTP Status: $http_code"
            
            if [ "$http_code" -eq 200 ]; then
              echo "âœ… Article $i published successfully"
            else
              echo "âŒ Failed to publish article $i"
              # ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
            fi
            
            # ë§ˆì§€ë§‰ ê¸°ì‚¬ê°€ ì•„ë‹ˆë©´ 30~90ë¶„ ëŒ€ê¸° (ì´ˆ ë‹¨ìœ„)
            if [ $i -lt 10 ]; then
              # 30~90ë¶„ ì‚¬ì´ ëœë¤ (1800~5400ì´ˆ)
              wait_seconds=$((RANDOM % 3601 + 1800))
              wait_minutes=$((wait_seconds / 60))
              
              echo ""
              echo "â° Waiting $wait_minutes minutes before next article..."
              echo "   ($(date '+%Y-%m-%d %H:%M:%S'))"
              
              sleep $wait_seconds
            fi
          done
          
          echo ""
          echo "========================================="
          echo "ğŸ‰ All articles published!"
          echo "========================================="
      
      - name: Notify on failure
        if: failure()
        run: |
          echo "âš ï¸ Scheduled publishing failed!"
          # ì—¬ê¸°ì— Slack/Discord ì•Œë¦¼ ì¶”ê°€ ê°€ëŠ¥
